
# [Diamond V] Bliski Brojevi - 18277

[문제 링크](https://www.acmicpc.net/problem/18277)

### 문제 요약

<p> $N$개의 수열과 $Q$개의 쿼리가 주어진다. 각 쿼리마다 주어지는 구간에서의 $l ≤ i < j ≤ r$ 인 $min(|pi - pj|)$ 값을 구해보자. </p>

### 제한

TL : 2sec, ML : 512 MB

$1 ≤ N, Q ≤ 30,000$

### 성능 요약

메모리: 3380 KB, 시간: 1616 ms

### 분류

자료 구조(data_structures), 세그먼트 트리(segtree), 오프라인 쿼리(offline_queries), mo's(mo's algorithm)

### comment

척 보면 오프라인 쿼리 냄새가 솔솔 난다. 업데이트 역시 없기 때문에 mo's를 떠올려 볼 수 있다.

그럼 문제는 결국 현재 관리하는 구간( $[s, e]$ )에서의 $X$ ( $l ≤ i < j ≤ r$ 를 만족하는 $min(|p_i$ - $p_j|)$ ) 를 어떻게 빨리 구할 수 있느냐인데..

" $p_i$는 중복이 없으며 등장하는 수의 범위 역시 $1 ≤ p_i ≤ N$ 를 만족한다." 이 녀석을 이용해보자.

-----------------------------------------------------------------------------------------------------------------------------------------------------------------------

$[s, e]$ 의 정보만을 담은 세그먼트 트리를 생각해보자.

또, 이 세그 내 각 노드에선 해당 노드가 관리하는 구간에서의 $X$ 를 들고 있다고 해보자.

그럼 $[s, e]$에 대한 답은 항상 $seg[1]$에 담겨 있게 되고 $[s, e]$ 의 $s$, $e$가 끝점에서 변할 때마다 적절한 업데이트만 취해주면 된다.

#### 중요한 건, 세그에서 관리하고 있는 값은 $[s, e]$ 에 속한 값 뿐이라는 점이다.

-----------------------------------------------------------------------------------------------------------------------------------------------------------------------

각 노드마다 앞서 이야기 한 값을 들고 있으려면 다음과 같이 두 개의 추가적인 정보가 필요하다.

* 해당 노드가 담당하는 구간 내 최솟값.
* 해당 노드가 담당하는 구간 내 최댓값.

그럼 노드마다 다음 세가지 값에서의 최솟값이 $X$가 됨을 알 수 있다.

* 왼 쪽 자식 노드의 $X$.
* 오른 쪽 자식 노드의 $X$.
* 오른 쪽 자식 노드의 최솟값 - 왼 쪽 자식 노드의 최댓값.

-----------------------------------------------------------------------------------------------------------------------------------------------------------------------

세그과 관리하는 구간은 $1 ~ N$이지만 실제 고려해야 하는 값들은 $[s, e]$ 에 실존하는 값 뿐이다.

이 점을 반드시 유의한 채로 위 로직을 수행 하여야 한다.

(나는 고려하지 않아야 하는 노드들에 대해선 모두 $0$으로 기준을 잡아 주었다.)

그렇게 쿼리마다 업데이트를 마친 후 세그의 첫번째 노드에 담긴 $X$값을 취해주면 되겠다.

-----------------------------------------------------------------------------------------------------------------------------------------------------------------------

범위가 작아 이 정도로 상수 차이가 크게 날 줄 몰랐는데, 재귀 세그로 AC 받기가 꽤 빡빡해 보인다.

TLE 한 번 맞고 1912ms로 처음 AC를 받은 뒤, 이것 저것 건드리며 1616ms까지 줄여보긴 했지만

N ≤ 3e4 가 재귀 세그로 타협 가능한 마지노선 범위였는듯..

비재귀 세그로 짜면 훨씬 널널하게 될 듯 하다.
